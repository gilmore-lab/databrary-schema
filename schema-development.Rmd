---
title: "Databrary 2.0 schema development"
output: 
  html_notebook:
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: hide
params:
  db_login: your@email.com
---

# Purpose

To document Rick Gilmore's work on the Databrary 2.0 schema.

# Resources

Jeff Spies, Swapnaa Jayaraman, and Rick Gilmore are also using this Google Doc as a working document:

https://docs.google.com/document/d/1_becXD6YX6lqgn4LK0IhgWII5C_pBzcQWFGDLx-SY_Y/edit?usp=sharing

I'm using DB1 to refer to Databrary 1.0 and DB2 to refer to Databrary 2.0.

# Type by type

Login to Databrary by running `rmarkdown::render("schema-development.Rmd", params = list(db_login="YOUREMAIL@PROVIDER.COM"))` from the RStudio console.

```{r}
databraryapi::login_db(params$db_login)
```

## Institutions

In DB1, all Institutions are instances of `party`, but with some special properties.

The DB1 API returns the following data for an Institution like NYU.

```{r}
databraryapi::download_party(8)
```

### Schema suggestions

Based on the CollegeOrUniversity schema (http://schema.org/CollegeOrUniversity), I suggest the following mappings:

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
| `id`          | `identifier`      | http://schema.org/identifier  | Use structured scheme for institutional IDs |
| `sortname`    | `alternateName`   | http://schema.org/alternateName | Add official name as separate entity |                         
| `url`         | `url`             | http://schema.org/url           | |
| `institution` |                   |                                 | Boolean value in DB1; needed in DB2? |
| https://nyu.databrary.org/party/8/avatar?size=500 | `logo` | http://schema.org/logo | |

I also suggest the following additions:

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
|               | `name`            | http://schema.org/name | New field with official name, here New York University |
|               | `address`         | http://schema.org/address | |
|               | `contactPoint`    | http://schema.org/contactPoint  |  |

## AccountHolders

In DB1, all users are instances of `party`.

Here, for example, is what the DB1 API returns for Rick Gilmore:

```{r}
databraryapi::download_party(6)
```

These are largely self-explanatory except for `permission`. 
Let's investigate this.

```{r}
db_const <- databraryapi::assign_constants()
str(db_const)
```

It's pretty straightforward.
The `permission` is one of `r db_const$permission`. I have `r db_const$permission[5]` because it's my profile, possibly.

Yes, that's right.
See what happens when I query Karen's:

```{r}
databraryapi::download_party(5)
```

There is no `permission` defined.
I'm not sure how we'll map this in the new schema.

### Schema suggestions

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
| `id`          | `identifier`      | http://schema.org/identifier | Use structured scheme for IDs of people, maybe prefix current party ID with `p` |
| `sortname`    | `familyName`   | http://schema.org/familyName |  | 
| `prename`     | `givenName`    | http://schema.org/givenName  | |
| `orcid`       |                |                              | |
| `affiliation` |  `worksFor`     |  http://schema.org/worksFor  | |
| `url`         | `url`             | http://schema.org/url           | |
| `email`       | `email`           | http://schema.org/email         | |
| `permission`  |                   |                                 | |
| https://nyu.databrary.org/party/6/avatar?size=500 | `image` | http://schema.org/logo | |

With the following addition(s):

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
|               | `address`         | http://schema.org/address | |
|               | `additionalName`   | http://schema.org/additionalName | Middle name |
|               | `honorificPrefix`  | http://schema.org/honorificPrefix | e.g., Dr. |
|               | `honorificSuffix`  | http://schema.org/honorificSuffix | e.g., Ph.D. |
|               | `jobTitle`         | http://schema.org/jobTitle | |
|               | `telephone`        | http://schema.org/telephone | |

## Volume (Project)

Here is the structure of the output from the DB1 API for a volume, in this case, the default is volume 1 (https://nyu.databrary.org/volume/1):

```{r}
str(databraryapi::download_containers_records())
```

We also have the project's icon at <https://nyu.databrary.org/volume/1/thumb?size>, so apparently the `thumb` variable holds the icon.

### Schema suggestions

Let's try the DataCatalog (http://schema.org/DataCatalog) schema to start mapping the volume-level items.

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
| `id`          | `identifier`      | http://schema.org/identifier | |
| `name`        | `name`            | http://schema.org/name ||
| `body`        | `abstract`        | http://schema.org/abstract ||
| `doi`         |                   | | Use `citation` or ? |
| `creation`    | `dateCreated`     | http://schema.org/dateCreated ||
| `owners`      | `creator`         | http://schema.org/creator | How to handle different types of 'ownership' |
| `permission`  |              |                                | See related discussion above |
| `publicshareful` |            |                                | |
| `publicaccess`   |            |                               | |
| https://nyu.databrary.org/volume/1/thumb?size                | `thumbnailUrl` | http://schema.org/thumbnailUrl | |          

We'll deal with the `containers` array separately, as that is where the spreadsheet/session data reside.

The following seem like logical additions to the volume level schema:

| DB1           | Suggested mapping | Schema URL | Comments |
|---------------|-------------------|------------|----------|
|               | `dateModified`    | http://schema.org/dateModified | |
|               | `datePublished`   | http://schema.org/datePublished | |
|               | `dataset`         | http://schema.org/dataset | |
|               | `measurementTechnique` | http://pending.schema.org/measurementTechnique | |
|               | `citation`        | http://schema.org/citation | But see `doi` query |
|               | `conditionsOfAccess` | http://pending.schema.org/conditionsOfAccess | |
|               | `contributor`       | http://schema.org/contributor | Possibly use for non-authorial/citation contributors |
|               | `copyrightHolder`    | http://schema.org/copyrightHolder | |
|               |                      | http://schema.org/copyrightYear | |
|               | `creativeWorkStatus` | http://pending.schema.org/creativeWorkStatus | |
|                | `funder`             | http://schema.org/funder | Not sure how funders are handled now |
|                | `hasPart`            | http://schema.org/hasPart | For subcomponents |
|                | `inLanguage`         | http://schema.org/inLanguage | |
|                | `interactionStatistic` | http://schema.org/interactionStatistic |  For view/download counts |
|                | `isPartOf`           | http://schema.org/isPartOf | For relations between projects |
|                | `keywords`           | http://schema.org/keywords | |
|                | `publication`         | http://schema.org/publication | |
|                | `version`             | http://schema.org/version | |
|                | `sameAs`              | http://schema.org/sameAs | |

